# 0,1. pentest app desktop

application này KHÔNG HỖ TRỢ KẾT NỐI PROXY để capture request qua BurpSuite. Vậy ở đây chúng ta sẽ có nhiều cách để pentest case này:

1. Cài đặt một số phần mềm có thể capture request như Wireshark, HTTP Debugger, Charles, ... vấn đề là mình không quen sử dụng, không có nhiều tính năng như BurpSuite. Không có repeater để sửa request các thứ, muốn sửa request phải copy raw request rồi paste sang BurpSuite để pentest ![image](https://hackmd.io/_uploads/B1oHDG1cA.png)
2. Cài một con máy ảo lên, cài application đó vào máy ảo rồi mở proxy toàn hệ thống kết nối qua BurpSuite. Dở một cái là nó khá tốn phần cứng (đối với những ai máy yếu thì cả là một cực hình), việc tạo kết nối proxy full OS như thế sẽ có nhiều connect rác, mình không sử dụng đến, có thể giải quyết bằng việc add scope với BurpSuite nhưng mà vẫn nặng
3. Sử dụng một chương trình có thể control network của process đó rồi hướng tất cả connection đi qua 1 proxy (ở đây là BurpSuite)

## Proxifer

- Nếu bạn muốn điều hướng Traffic (bắt Traffic) của từng App trên máy tính (Windows hoặc Mac) tới Burp Suite một cách dễ dàng. Hãy sử dụng phần **Proxifier** nha.
- Ưu điểm của nó là không phải cài đặt Proxy cho toàn bộ máy tính. Cấu hình dễ dàng chỉ bằng click chuột. Có thể điều hướng từng App sử dụng các Proxy khác nhau.
- dùng Proxifier, điều hướng traffic của các ứng dụng trên Win về Proxy của Burpsuite

![image](https://hackmd.io/_uploads/SkS2qy2OC.png)

# Hướng dẫn sử dụng Proxifier để chuyển request API đến Burp Suite

## 1. Cài đặt Burp Suite

1. Tải Burp Suite từ trang web chính thức của PortSwigger.
2. Cài đặt và mở Burp Suite.
3. Đi tới **Proxy** > **Options**.
4. Trong **Proxy Listeners**, kiểm tra rằng bạn có một listener trên địa chỉ `127.0.0.1:8080`. Nếu không, hãy thêm một listener mới với địa chỉ và cổng này.

## 2. Cấu hình Proxifier

1. Mở Proxifier.
2. Chọn **Profile** > **Proxy Servers**.
3. Nhấn vào **Add** và nhập thông tin:
   - Address: `127.0.0.1`
   - Port: `8080`
   - Protocol: SOCKS v5 hoặc HTTPS (tùy thuộc vào cấu hình của Burp Suite, thường là HTTPS)
4. Nhấn **OK** để lưu proxy server.

## 3. Thiết lập Quy tắc trong Proxifier

1. Chọn **Profile** > **Proxification Rules**.
2. Nhấn vào **Add** để tạo một quy tắc mới.
3. Đặt tên cho quy tắc, ví dụ: "Burp Suite Redirect".
4. Trong **Applications**, chọn ứng dụng desktop bạn muốn kiểm thử.
5. Trong **Action**, chọn **Proxy Server** và chọn proxy server mà bạn đã cấu hình (127.0.0.1:8080).
6. Nhấn **OK** để lưu quy tắc.

## 4. Cài đặt Chứng chỉ Burp Suite (nếu cần)

-https://parsiya.net/blog/2016-02-21-installing-burp-certificate-authority-in-windows-certificate-store/#:~:text=Installing%20Burp's%20Root%20CA%20in%20Windows%20Certificate%20Store,-Double%20click%20the&text=Select%20Place%20all%20certificates%20in%20the%20following%20store%20and%20then%20select%20Browse%20.&text=Select%20Trusted%20Root%20Certification%20Authorities,press%20Ok%20and%20then%20Next%20.&text=If%20you%20did%20not%20have,warning%20screen%20after%20clicking%20Finish%20.

1. Trong Burp Suite, đi tới **Proxy** > **Options** > **Import / export CA certificate**.
2. Chọn **Export Certificate in DER format** và lưu tệp này.
3. Cài đặt chứng chỉ này vào hệ điều hành của bạn để nó được tin cậy bởi các ứng dụng sử dụng HTTPS.

## 5. Kiểm tra và Phân tích

1. Mở ứng dụng desktop của bạn.
2. Thực hiện các hành động gửi request API.
3. Trong Burp Suite, đi tới **Proxy** > **HTTP history** để xem các request và response.
4. Sử dụng các tính năng của Burp Suite để phân tích và kiểm thử các request.

## Lưu ý

- Đảm bảo rằng bạn có quyền hợp pháp để thực hiện pentest trên ứng dụng mà bạn đang kiểm thử.
- Nếu ứng dụng của bạn sử dụng HTTPS, việc cài đặt chứng chỉ của Burp Suite vào hệ thống là cần thiết để các request HTTPS có thể được giải mã và phân tích bởi Burp Suite.

Với các bước này, bạn có thể sử dụng Proxifier để chuyển hướng các request API từ ứng dụng desktop đến Burp Suite để thực hiện kiểm thử bảo mật.

## Cấu hình

- Các bạn download rồi về cài đặt như bình thường, khởi động program lên thì add proxy server vào thôi (Profile -> Proxy Servers)

![image](https://hackmd.io/_uploads/S1cuN7kqA.png)

![image](https://hackmd.io/_uploads/HJ-FmLJ90.png)

Tiếp theo đến cài đặt rules để cho Proxifier có thể giúp mình kết nối các process chỉ định tới proxy server. (Profile -> Proxification Rules)

Ở phần này, các bạn nhớ để rule Default có action là Direct nhé, để tránh làm nặng proxy server. Khi muốn add 1 program để cho nó kết nối thông qua proxy server thì add rule như hình bên dưới

![image](https://hackmd.io/_uploads/SJtz4IJ5A.png)

![image](https://hackmd.io/_uploads/H1EC7I15A.png)

Vậy xong rồi, toàn bộ connection trên process của program đều được thông qua BurpSuite hết,

![image](https://hackmd.io/_uploads/B1V-mU1cR.png)

### dùng burpsutie để chặn request từ Postman ccho API

- https://www.youtube.com/shorts/gW26SIWYGuw

# Hướng dẫn tải và cài đặt chứng chỉ CA của Burp Suite trên Windows

## Bước 1: Tải chứng chỉ CA từ Burp Suite

1. **Mở Burp Suite:**

   - Khởi động Burp Suite trên máy tính của bạn.
   - Đi tới tab **Proxy**.

2. **Cấu hình Proxy Listener:**

   - Trong **Proxy** tab, chọn **Options**.
   - Đảm bảo rằng bạn có một Proxy Listener đang chạy trên `127.0.0.1:8080` (đây là cài đặt mặc định).

3. **Tải chứng chỉ CA:**
   - Mở trình duyệt web (ví dụ: Chrome, Firefox) và cấu hình trình duyệt để sử dụng proxy `127.0.0.1:8080`.
   - Truy cập địa chỉ `http://burpsuite` trong trình duyệt. Trang web Burp Suite sẽ mở ra.
   - Nhấp vào liên kết để tải chứng chỉ CA (`CA Certificate`) và lưu tệp này vào máy tính của bạn. Tệp chứng chỉ sẽ có định dạng `.cer`.

## Bước 2: Cài đặt chứng chỉ CA trên Windows

1. **Mở tệp chứng chỉ:**

   - Tìm tệp `.cer` mà bạn đã tải về và nhấp đúp vào tệp đó để mở.

2. **Cài đặt chứng chỉ:**

   - Trong cửa sổ chứng chỉ, nhấp vào nút **Install Certificate**.

3. **Chọn vị trí lưu trữ:**

   - Trình hướng dẫn cài đặt chứng chỉ sẽ mở ra. Chọn **Local Machine** để cài đặt chứng chỉ cho toàn bộ hệ thống hoặc **Current User** nếu bạn chỉ muốn cài đặt cho tài khoản người dùng hiện tại.
   - Nhấp vào **Next**.

4. **Chọn kho lưu trữ:**

   - Chọn **Place all certificates in the following store**.
   - Nhấp vào **Browse** và chọn **Trusted Root Certification Authorities**.
   - Nhấp vào **OK**, sau đó nhấp vào **Next** và cuối cùng là **Finish**.

5. **Hoàn tất cài đặt:**
   - Bạn sẽ thấy một thông báo rằng việc cài đặt chứng chỉ đã thành công. Nhấp vào **OK**.

## Bước 3: Xác minh cài đặt chứng chỉ

1. **Mở trình quản lý chứng chỉ:**

   - Nhấn tổ hợp phím `Win + R`, nhập `mmc` và nhấn **Enter**.
   - Trong cửa sổ Console, chọn **File** > **Add/Remove Snap-in**.
   - Chọn **Certificates** và nhấp vào **Add**.
   - Chọn **Computer account** nếu bạn đã cài đặt chứng chỉ cho toàn bộ hệ thống, hoặc **My user account** nếu bạn đã cài đặt cho tài khoản người dùng hiện tại. Nhấp vào **Next**, sau đó nhấp vào **Finish**.

2. **Kiểm tra chứng chỉ:**
   - Trong trình quản lý chứng chỉ, mở rộng **Trusted Root Certification Authorities** > **Certificates**.
   - Kiểm tra xem chứng chỉ của Burp Suite có nằm trong danh sách hay không. Nếu có, chứng chỉ đã được cài đặt thành công.

![image](https://hackmd.io/_uploads/Bk8xULk90.png)

Bây giờ, tất cả các ứng dụng và trình duyệt trên hệ thống của bạn sẽ tin tưởng các chứng chỉ SSL/TLS được tạo bởi Burp Suite.

## Tham khảo

- https://viblo.asia/p/proxifier-ho-tro-ket-noi-proxy-cho-cac-ung-dung-khong-ho-tro-proxy-eW65GB3RlDO
- https://www.youtube.com/watch?v=GCrG3WoJQ1A
- https://www.facebook.com/100063699213066/posts/538770056309158/
- https://zingserver.com/cai-dat-proxifier-key-ban-quyen/
